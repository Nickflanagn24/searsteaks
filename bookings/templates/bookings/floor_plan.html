{% extends "bookings/base.html" %}
{% block content %}
<h2>Select a Table</h2>
<p>Click on an available table to proceed with your reservation.</p>

{% if not user.is_authenticated %}
    <p><em>Log in to reserve a table. You can view availability below!</em></p>
{% endif %}

<div id="floor-plan">
    {% for table in tables %}
        <div class="table {% if not table.is_available %}unavailable{% endif %}" 
             data-table="{{ table.id }}"
             onclick="selectTable('{{ table.id }}')">
            Table {{ table.table_number }}
        </div>
    {% endfor %}
</div>

<p id="selected-table-text">Selected Table: None</p>
<button id="continue-btn" onclick="proceedToBooking()" disabled>Continue</button>

<script>
    const userIsAuthenticated = "{{ user.is_authenticated|yesno:'true,false' }}";

    function selectTable(tableId) {
        const tableElement = document.querySelector(`div[data-table='${tableId}']`);

        if (tableElement.classList.contains('unavailable')) {
            alert("Sorry, this table is already booked.");
            return;
        }

        if (userIsAuthenticated === 'false') {
            // Redirect to login page
            alert("You need to log in or register to book a table.");
            window.location.href = "{% url 'login' %}?next={% url 'floor_plan' %}";
            return;
        }

        // If authenticated, redirect to booking page
        window.location.href = `/make-booking/?table_id=${tableId}`;
    }
</script>

<style>
    #floor-plan {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .table {
        width: 100px;
        height: 100px;
        background-color: green;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        cursor: pointer;
        border-radius: 10px;
    }
    .table.unavailable {
        background-color: red;
        cursor: not-allowed;
    }
</style>
{% endblock %}
